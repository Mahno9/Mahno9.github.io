<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Интерактивное Бинго</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f5f5f5;
        }
        .bingo-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .bingo-wrapper {
            position: relative;
            display: inline-block;
        }
        .bingo-image {
            width: 400px; /* Adjust based on actual image size */
            height: auto;
            display: block;
        }
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .block {
            position: absolute;
            width: 17%; /* Adjust to match the block size */
            height: 13%; /* Adjust to match the block size */
            background-color: transparent;
            cursor: pointer;
            border-radius: 5px;
            transition: background 0.2s ease;
        }
        /* Colors */
        .pink { background-color: rgba(255, 105, 180, 0.5); } /* Pink */
        .blue { background-color: rgba(100, 149, 237, 0.5); } /* Blue */
        .both { background: linear-gradient(45deg, rgba(255, 105, 180, 0.5), rgba(100, 149, 237, 0.5)); } /* Both Colors */
        
        .share-button {
            margin: 20px auto;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .share-button:hover {
            background-color: #45a049;
        }
        
        .share-url {
            margin: 15px auto;
            padding: 10px;
            width: 80%;
            max-width: 600px;
            display: none;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <h1>Интерактивное Бинго</h1>
    <p>Нажмите на ячейки, чтобы выделить их цветом.</p>
    
    <button id="shareButton" class="share-button">Поделиться результатом</button>
    <input type="text" id="shareUrl" class="share-url" readonly>
    
    <div class="bingo-container" id="bingoContainer"></div>

    <button id="shareButtonBottom" class="share-button" style="margin-top: 30px;">Поделиться результатом</button>
    <input type="text" id="shareUrlBottom" class="share-url" readonly>

    <script>
        const imageCount = 6; // Number of images (1.jpg to 6.jpg)
        const container = document.getElementById("bingoContainer");
        const positions = [
            { x: 9.8, y: 25 }, { x: 31, y: 25 }, { x: 52, y: 25 }, { x: 73, y: 25 }, 

			{ x: 9.8, y: 41.5 }, { x: 31, y: 41.5 }, { x: 52, y: 41.5 }, { x: 73, y: 41.5 }, 

            { x: 9.8, y: 58 }, { x: 31, y: 58 }, { x: 52, y: 58 }, { x: 73, y: 58 }, 

            { x: 9.8, y: 74.5 }, { x: 31, y: 74.5 }, { x: 52, y: 74.5 }, { x: 73, y: 74.5 }  
        ]; // Adjust based on block positions

        // Проверяем, есть ли данные в URL
        function loadFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const bingoData = urlParams.get('data');
            
            if (bingoData) {
                try {
                    const decodedData = JSON.parse(atob(bingoData));
                    
                    // Очищаем localStorage перед загрузкой новых данных
                    for (let i = 1; i <= imageCount; i++) {
                        for (let j = 0; j < positions.length; j++) {
                            localStorage.removeItem(`bingo-${i}-${j}`);
                        }
                    }
                    
                    // Загружаем данные из URL в localStorage
                    Object.keys(decodedData).forEach(key => {
                        localStorage.setItem(key, decodedData[key]);
                    });
                } catch (e) {
                    console.error("Ошибка при разборе данных URL:", e);
                }
            }
        }

        function loadImages() {
            // Сначала загружаем данные из URL, если они есть
            loadFromUrl();
            
            for (let i = 1; i <= imageCount; i++) {
                const wrapper = document.createElement("div");
                wrapper.classList.add("bingo-wrapper");

                const img = document.createElement("img");
                img.src = `${i}.jpg`;
                img.classList.add("bingo-image");

                const overlay = document.createElement("div");
                overlay.classList.add("overlay");

                positions.forEach((pos, index) => {
                    const block = document.createElement("div");
                    block.classList.add("block");
                    block.style.left = `${pos.x}%`;
                    block.style.top = `${pos.y}%`;

                    // Restore selection from localStorage
                    const key = `bingo-${i}-${index}`;
                    const savedState = localStorage.getItem(key);
                    if (savedState) block.classList.add(savedState);

                    block.addEventListener("click", () => toggleColor(block, key));

                    overlay.appendChild(block);
                });

                wrapper.appendChild(img);
                wrapper.appendChild(overlay);
                container.appendChild(wrapper);
            }
        }

		function toggleColor(block, key) {
			if (block.classList.contains("pink") && block.classList.contains("blue")) {
				// If both colors are applied, clear everything
				block.classList.remove("pink", "blue", "both");
				localStorage.removeItem(key);
			} else if (block.classList.contains("pink")) {
				// If only pink is applied, switch to blue
				block.classList.remove("pink");
				block.classList.add("blue");
				localStorage.setItem(key, "blue");
			} else if (block.classList.contains("blue")) {
				// If only blue is applied, add pink (both colors)
				block.classList.add("pink");
				block.classList.add("both");
				localStorage.setItem(key, "both");
			} else {
				// If no color, start with pink
				block.classList.add("pink");
				localStorage.setItem(key, "pink");
			}
		}
        
        // Функция для создания URL для обмена
        function generateShareableUrl() {
            const bingoData = {};
            
            // Собираем все данные из localStorage, относящиеся к бинго
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('bingo-')) {
                    bingoData[key] = localStorage.getItem(key);
                }
            }
            
            // Кодируем данные для URL
            const encodedData = btoa(JSON.stringify(bingoData));
            
            // Создаем URL с параметром data
            const url = `${window.location.origin}${window.location.pathname}?data=${encodedData}`;
            
            return url;
        }
        
        // Настраиваем кнопку "Поделиться" вверху страницы
        document.getElementById('shareButton').addEventListener('click', function() {
            shareResult('shareUrl');
        });
        
        // Настраиваем кнопку "Поделиться" внизу страницы
        document.getElementById('shareButtonBottom').addEventListener('click', function() {
            shareResult('shareUrlBottom');
        });
        
        // Общая функция для обработки нажатия на кнопку "Поделиться"
        function shareResult(targetInputId) {
            const shareUrl = document.getElementById(targetInputId);
            const url = generateShareableUrl();
            
            shareUrl.value = url;
            shareUrl.style.display = 'block';
            shareUrl.select();
            
            try {
                // Пытаемся скопировать URL в буфер обмена
                document.execCommand('copy');
                alert('Ссылка скопирована в буфер обмена!');
            } catch (err) {
                console.error('Не удалось скопировать: ', err);
            }
        }

        loadImages();
    </script>

</body>
</html>
